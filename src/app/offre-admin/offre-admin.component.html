<!-- NAVBAR -->
<nav class="navbar">
  <div class="navbar-left">
    <button class="hamburger" (click)="toggleSidebar()" aria-label="Toggle sidebar">
      <span></span><span></span><span></span>
    </button>
    <span class="brand">SIGA <small class="brand-sub">Admin</small></span>
  </div>

  <form class="search-wrapper" (submit)="$event.preventDefault(); applyFilter()">
    <div class="search-field">
      <input
        class="search"
        type="search"
        [(ngModel)]="searchTerm"
        name="search"
        placeholder="Recherche: nom, pr√©nom, email..."
        aria-label="Search candidates"
      />
      <button class="btn btn-search" type="button" (click)="applyFilter()" title="Rechercher">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </form>

  <div class="navbar-right">
    <div class="notif">
      <button class="icon-btn" title="Notifications"><i class="fas fa-bell"></i></button>
    </div>

    <div class="user">
      <div class="user-info">
        <div class="user-emoji">üëã</div>
        <div class="user-text">
          <div class="user-hi">Bienvenue</div>
          <div class="user-name">{{ username }}</div>
        </div>
      </div>
      <button class="btn-logout" title="D√©connexion" (click)="onLogout()">
          <i class="fas fa-sign-out-alt"></i>
      </button>    
    </div>
  </div>
</nav>

<!-- SIDEBAR -->
<aside class="sidebar" [class.collapsed]="sidebarCollapsed">
  <div class="sidebar-top">
    <div class="brand">
      <i class="fas fa-rocket"></i>
      <span>SIGA</span>
    </div>
    <button class="collapse-btn" (click)="toggleSidebar()" title="Toggle Sidebar">
      <i class="fas" [ngClass]="sidebarCollapsed ? 'fa-angle-right' : 'fa-angle-left'"></i>
    </button>
  </div>

  <nav class="nav-links">
    <a routerLink="/getall" routerLinkActive="active"><i class="fas fa-tachometer-alt"></i><span class="link-text">Dashboard</span></a>
    <a routerLink="/recommendation" routerLinkActive="active"><i class="fas fa-file-alt"></i><span class="link-text">Analyse CV</span></a>
    <a routerLink="/getCandidats" routerLinkActive="active"><i class="fas fa-users"></i><span class="link-text">Candidats</span></a>
    <a routerLink="/Calendrier" routerLinkActive="active"><i class="fas fa-calendar-alt"></i><span class="link-text">Calendrier</span></a>
  <a routerLink="/OfferByAdmin" routerLinkActive="active">
      <i class="fas fa-briefcase"></i><span class="link-text">Gestion Offres</span>
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="user-profile">
      <div class="avatar">üëã</div>
      <div class="user-info">
        <span class="name">Admin</span>
        <small class="role">Super Admin</small>
      </div>
    </div>
    <small class="version">v1.0 ‚Ä¢ SIGA</small>
  </div>
</aside>
<!-- MAIN CONTENT -->
<main class="main-content" [class.expanded]="sidebarCollapsed">
  <!-- STATS CARDS -->
  <section class="stats-section">
    <div class="stat-card stat-card-total">
      <div class="stat-icon">
        <i class="fas fa-briefcase"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalOffres }}</div>
        <div class="stat-label">Total des Offres</div>
      </div>
    </div>
    <div class="stat-card stat-card-active">
      <div class="stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ activeOffres }}</div>
        <div class="stat-label">Offres Actives</div>
      </div>
    </div>
    <div class="stat-card stat-card-inactive">
      <div class="stat-icon">
        <i class="fas fa-pause-circle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ inactiveOffres }}</div>
        <div class="stat-label">Offres Inactives</div>
      </div>
    </div>
    <div class="stat-card stat-card-action">
      <button class="btn-add-large" (click)="onAddOffre()">
        <i class="fas fa-plus-circle"></i>
        <span>Nouvelle Offre</span>
      </button>
    </div>
  </section>

  <!-- CONTROLS BAR -->
  <section class="controls-bar">
    <div class="controls-left">
      <div class="filter-group">
        <button 
          class="filter-btn" 
          [class.active]="filterStatus === 'all'"
          (click)="setFilterStatus('all')"
        >
          Toutes ({{ totalOffres }})
        </button>
        <button 
          class="filter-btn" 
          [class.active]="filterStatus === 'active'"
          (click)="setFilterStatus('active')"
        >
          Actives ({{ activeOffres }})
        </button>
        <button 
          class="filter-btn" 
          [class.active]="filterStatus === 'inactive'"
          (click)="setFilterStatus('inactive')"
        >
          Inactives ({{ inactiveOffres }})
        </button>
      </div>
    </div>

    <div class="controls-right">
      <div class="sort-group">
        <label class="sort-label">Trier par:</label>
        <select class="sort-select" [(ngModel)]="sortBy" (change)="applyFilter()">
          <option value="recent">Plus r√©cent</option>
          <option value="title">Titre (A-Z)</option>
          <option value="posts">Nombre de postes</option>
        </select>
      </div>

      <div class="view-toggle">
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'grid'"
          (click)="setView('grid')"
          title="Vue grille"
          aria-label="Grid view"
        >
          <i class="fas fa-th-large"></i>
        </button>
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'list'"
          (click)="setView('list')"
          title="Vue liste"
          aria-label="List view"
        >
          <i class="fas fa-list"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- LOADING STATE -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des offres d'emploi...</p>
  </div>

  <!-- ERROR STATE -->
  <div *ngIf="error && !loading" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>Une erreur est survenue</h3>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadOffres()">
      <i class="fas fa-redo"></i> R√©essayer
    </button>
  </div>

  <!-- EMPTY STATE -->
  <div *ngIf="!loading && !error && filteredOffres.length === 0" class="empty-state">
    <i class="fas fa-inbox"></i>
    <h3>Aucune offre trouv√©e</h3>
    <p *ngIf="searchTerm">Aucun r√©sultat pour "{{ searchTerm }}"</p>
    <p *ngIf="!searchTerm">Commencez par cr√©er votre premi√®re offre d'emploi</p>
    <button class="btn-primary" (click)="onAddOffre()">
      <i class="fas fa-plus"></i> Cr√©er une offre
    </button>
  </div>

  <!-- OFFERS GRID VIEW -->
  <div *ngIf="!loading && !error && paginatedOffres.length > 0 && viewMode === 'grid'" class="offers-grid">
    <article *ngFor="let offre of paginatedOffres" class="offer-card">
      <div class="offer-header">
        <div class="offer-status" [class.status-active]="offre.enable" [class.status-inactive]="!offre.enable">
          <i class="fas" [ngClass]="offre.enable ? 'fa-check-circle' : 'fa-pause-circle'"></i>
          {{ offre.enable ? 'Active' : 'Inactive' }}
        </div>
        <div class="offer-badge">
          <i class="fas fa-users"></i>
          {{ offre.nbreDePoste }} poste{{ offre.nbreDePoste > 1 ? 's' : '' }}
        </div>
      </div>

      <h3 class="offer-title">{{ offre.titreOffre }}</h3>
      
      <p class="offer-description">
        {{ offre.descriptionJob.length > 120 ? (offre.descriptionJob | slice:0:120) + '...' : offre.descriptionJob }}
      </p>

      <div class="offer-profile">
        <i class="fas fa-user-tie"></i>
        <span>{{ offre.profilRecherche }}</span>
      </div>

      <div class="offer-skills">
        <span class="skill-tag" *ngFor="let skill of getSkillsArray(offre.competencesTechniques)">
          {{ skill }}
        </span>
      </div>

      <div class="offer-actions">
        <button 
          class="action-btn action-toggle" 
          (click)="onToggleEnable(offre)"
          [title]="offre.enable ? 'D√©sactiver' : 'Activer'"
        >
          <i class="fas" [ngClass]="offre.enable ? 'fa-pause' : 'fa-play'"></i>
        </button>
        <button class="action-btn action-edit" (click)="onEditOffre(offre)" title="Modifier">
          <i class="fas fa-edit"></i>
        </button>
        <button class="action-btn action-view" (click)="onViewOffre(offre)" title="Voir d√©tails">
          <i class="fas fa-eye"></i>
        </button>
        <button class="action-btn action-delete" (click)="onDeleteOffre(offre)" title="Supprimer">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </article>
  </div>

  <!-- OFFERS LIST VIEW -->
  <div *ngIf="!loading && !error && paginatedOffres.length > 0 && viewMode === 'list'" class="offers-list">
    <article *ngFor="let offre of paginatedOffres" class="offer-list-item">
      <div class="list-item-left">
        <div class="list-item-icon">
          <i class="fas fa-briefcase"></i>
        </div>
        <div class="list-item-content">
          <div class="list-item-header">
            <h3 class="list-item-title">{{ offre.titreOffre }}</h3>
            <div class="list-item-badges">
              <span class="badge" [class.badge-active]="offre.enable" [class.badge-inactive]="!offre.enable">
                <i class="fas" [ngClass]="offre.enable ? 'fa-check-circle' : 'fa-pause-circle'"></i>
                {{ offre.enable ? 'Active' : 'Inactive' }}
              </span>
              <span class="badge badge-neutral">
                <i class="fas fa-users"></i>
                {{ offre.nbreDePoste }} poste{{ offre.nbreDePoste > 1 ? 's' : '' }}
              </span>
            </div>
          </div>
          <p class="list-item-description">{{ offre.descriptionJob | slice:0:150 }}...</p>
          <div class="list-item-meta">
            <span class="meta-item">
              <i class="fas fa-user-tie"></i>
              {{ offre.profilRecherche }}
            </span>
            <span class="meta-separator">‚Ä¢</span>
            <span class="meta-item">
              <i class="fas fa-code"></i>
              {{ offre.competencesTechniques.split(',').length }} comp√©tence{{ offre.competencesTechniques.split(',').length > 1 ? 's' : '' }}
            </span>
          </div>
        </div>
      </div>
      <div class="list-item-actions">
        <button class="btn-list-action btn-toggle" (click)="onToggleEnable(offre)">
          <i class="fas" [ngClass]="offre.enable ? 'fa-pause' : 'fa-play'"></i>
          {{ offre.enable ? 'D√©sactiver' : 'Activer' }}
        </button>
        <button class="btn-list-action btn-edit" (click)="onEditOffre(offre)">
          <i class="fas fa-edit"></i>
          Modifier
        </button>
        <button class="btn-list-action btn-view" (click)="onViewOffre(offre)">
          <i class="fas fa-eye"></i>
          D√©tails
        </button>
        <button class="btn-list-action btn-delete" (click)="onDeleteOffre(offre)">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </article>
  </div>

  <!-- PAGINATION -->
  <nav *ngIf="!loading && !error && filteredOffres.length > 0" class="pagination" aria-label="Pagination">
    <button 
      class="page-btn page-prev" 
      (click)="prevPage()" 
      [disabled]="currentPage === 1"
      aria-label="Previous page"
    >
      <i class="fas fa-chevron-left"></i>
      Pr√©c√©dent
    </button>

    <div class="page-numbers">
      <ng-container *ngFor="let page of pageNumbers">
        <button 
          *ngIf="page > 0"
          class="page-number" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
          [attr.aria-label]="'Page ' + page"
          [attr.aria-current]="page === currentPage ? 'page' : null"
        >
          {{ page }}
        </button>
        <span *ngIf="page === -1" class="page-ellipsis">...</span>
      </ng-container>
    </div>

    <button 
      class="page-btn page-next" 
      (click)="nextPage()" 
      [disabled]="currentPage === totalPages"
      aria-label="Next page"
    >
      Suivant
      <i class="fas fa-chevron-right"></i>
    </button>
  </nav>

  <!-- EDIT MODAL -->
  <div *ngIf="editingOffre" class="modal-overlay" (click)="cancelEdit()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Modifier l'Offre</h2>
        <button class="modal-close" (click)="cancelEdit()" aria-label="Close modal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form class="modal-form" (ngSubmit)="saveEdit()">
        <div class="form-group">
          <label for="edit-titre">Titre de l'offre *</label>
          <input 
            id="edit-titre"
            type="text" 
            [(ngModel)]="editingOffre.titreOffre" 
            name="titre" 
            placeholder="Ex: D√©veloppeur Full Stack"
            required 
          />
        </div>

        <div class="form-group">
          <label for="edit-description">Description du poste *</label>
          <textarea 
            id="edit-description"
            [(ngModel)]="editingOffre.descriptionJob" 
            name="description" 
            rows="5" 
            placeholder="D√©crivez les responsabilit√©s et missions..."
            required
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="edit-profil">Profil recherch√© *</label>
            <input 
              id="edit-profil"
              type="text" 
              [(ngModel)]="editingOffre.profilRecherche" 
              name="profil" 
              placeholder="Ex: Junior, Senior..."
              required 
            />
          </div>

          <div class="form-group">
            <label for="edit-postes">Nombre de postes *</label>
            <input 
              id="edit-postes"
              type="number" 
              [(ngModel)]="editingOffre.nbreDePoste" 
              name="nbreDePoste" 
              min="1"
              placeholder="1"
              required 
            />
          </div>
        </div>

        <div class="form-group">
          <label for="edit-competences">Comp√©tences techniques *</label>
          <input 
            id="edit-competences"
            type="text" 
            [(ngModel)]="editingOffre.competencesTechniques" 
            name="competences" 
            placeholder="Ex: Angular, TypeScript, Node.js (s√©par√©es par des virgules)"
            required 
          />
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cancelEdit()">
            <i class="fas fa-times"></i>
            Annuler
          </button>
          <button type="submit" class="btn-save">
            <i class="fas fa-check"></i>
            Sauvegarder
          </button>
        </div>
      </form>
    </div>
  </div>
</main>

<!-- FOOTER -->
<footer class="footer" [class.expanded]="sidebarCollapsed">
  <div class="footer-left">
    <div class="footer-brand">
      <strong>SIGA Platform</strong>
      <span class="footer-divider">‚Ä¢</span>
      <span>13 Rue Ibn Nafis, Les Berges du Lac 3, Tunis</span>
    </div>
    <div class="footer-contact">
      <a href="mailto:contact&#64;siga.com.tn"><i class="fas fa-envelope"></i> contact&#64;siga.com.tn</a>
        <i class="fas fa-envelope"></i> contact&#64;siga.com.tn
      <span class="footer-divider">‚Ä¢</span>
      <a href="tel:+21671960281">
        <i class="fas fa-phone"></i> (+216) 71 960 281
      </a>
    </div>
  </div>
  <div class="footer-right">
    <span class="footer-version">v1.0.2</span>
    <a href="#" class="footer-link">Confidentialit√©</a>
    <a href="#" class="footer-link">Conditions</a>
  </div>
</footer>