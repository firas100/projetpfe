<!-- suivicandidature.component.html -->
<nav class="navbar">
  <div class="navbar-left">
    <button class="hamburger" (click)="toggleSidebar()" aria-label="Toggle sidebar">
      <span></span><span></span><span></span>
    </button>
    <span class="brand">SIGA <small class="brand-sub">Admin</small></span>
  </div>

  <form class="search-wrapper" (submit)="$event.preventDefault(); applyFilter()">
    <div class="search-field">
      <input
        type="search"
        class="search"
        placeholder="Recherche: nom, prÃ©nom, email..."
        [(ngModel)]="searchTerm"
        name="search"
        aria-label="Search candidates"
      />
      <button type="button" class="btn btn-search" (click)="applyFilter()" title="Rechercher">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </form>

  <div class="navbar-right">
    <div class="user">
      <div class="user-info">
        <div class="user-emoji">ðŸ‘‹</div>
        <div class="user-text">
          <div class="user-hi">Bienvenue</div>
          <div class="user-name">{{ username }}</div>
        </div>
      </div>
      <button class="btn-logout" title="DÃ©connexion" (click)="onLogout()">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </div>
</nav>

<aside class="sidebar" [class.collapsed]="sidebarCollapsed">
  <div class="sidebar-top">
    <div class="brand">
      <i class="fas fa-rocket"></i>
      <span>SIGA</span>
    </div>
    <button class="collapse-btn" (click)="toggleSidebar()">
      <i class="fas" [ngClass]="sidebarCollapsed ? 'fa-angle-right' : 'fa-angle-left'"></i>
    </button>
  </div>

  <nav class="nav-links">
    <a routerLink="/AllOffre" routerLinkActive="active">
      <i class="fas fa-file-alt"></i><span class="link-text">Offres</span>
    </a>
    <a routerLink="/MesCandidature" routerLinkActive="active">
      <i class="fas fa-calendar-alt"></i><span class="link-text">Mes Candidatures</span>
    </a>
    <a routerLink="/candidature" routerLinkActive="active">
      <i class="fas fa-briefcase"></i><span class="link-text">Gestion Offres</span>
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="user-profile">
      <div class="avatar">ðŸ‘‹</div>
      <div class="user-info">
        <span class="name">Admin</span>
        <small class="role">Super Admin</small>
      </div>
    </div>
    <small class="version">v1.0 â€¢ SIGA</small>
  </div>
</aside>

<div class="container">
  <div class="page-header">
    <h1 class="page-title">Mes Candidatures</h1>
    <p class="page-subtitle">Suivez l'Ã©volution de vos candidatures en temps rÃ©el</p>
  </div>

  <div *ngIf="isLoading" class="loading">Chargement en cours</div>
  <div *ngIf="errorMessage" class="text-danger">{{ errorMessage }}</div>

  <div class="table-container" *ngIf="!isLoading && candidatures.length > 0">
    <table class="table">
      <thead>
        <tr>
          <th>Poste</th>
          <th>Date de postulation</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let c of candidatures">
          <tr (click)="showProgress(c.id)" 
              [class.selected]="selectedCandidatureId === c.id">
            <td>{{ c.titreOffre }}</td>
            <td>{{ c.dateCandidature | date:'dd/MM/yyyy HH:mm' }}</td>
          </tr>

          <tr *ngIf="selectedCandidatureId === c.id" class="card-row">
            <td colspan="2" class="card-container">
              <div class="tracking-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-briefcase"></i>
                    {{ c.titreOffre }}
                  </h2>
                </div>

                <div *ngIf="selectedProgress" class="timeline">
                  <div class="timeline-connector" 
                       [style.width.%]="getProgressWidth(selectedProgress.currentStep)"></div>
                  
                  <div *ngFor="let step of selectedProgress.steps" 
                       class="timeline-step"
                       [class.completed]="isStepActive(step.code, selectedProgress.currentStep)">
                    <div class="timeline-marker" 
                         [class.completed]="isStepActive(step.code, selectedProgress.currentStep)">
                      <i class="fas" 
                         [ngClass]="isStepActive(step.code, selectedProgress.currentStep) ? 'fa-check' : getStepIcon(step.code)"></i>
                    </div>
                    <div class="timeline-label">{{ step.label }}</div>
                  </div>
                </div>

                <div *ngIf="!selectedProgress" class="loading">Chargement du suivi</div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && candidatures.length === 0" class="no-data">
    <i class="fas fa-inbox"></i>
    <p>Aucune candidature trouvÃ©e.</p>
  </div>
</div>

<footer class="footer">
  <div class="footer-left">
    <div class="brand-info">
      <strong>SIGA</strong>
      <span>â€¢ 13 Rue Ibn Nafis, Les berges du Lac 3, Tunis</span>
    </div>
    <div class="footer-links">
      <a href="mailto:contact&#64;siga.com.tn"><i class="fas fa-envelope"></i> contact&#64;siga.com.tn</a>
      <span>â€¢</span>
      <a href="tel:+21671960281"><i class="fas fa-phone"></i> (+216) 71 960 281</a>
    </div>
  </div>
  <div class="footer-right">
    <span>v1.0</span>
    <a href="#">Privacy</a>
    <a href="#">Terms</a>
  </div>
</footer>